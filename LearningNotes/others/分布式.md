# 分布式

## 分布式事务

> 参考文档：https://www.cnblogs.com/mayundalao/p/11798502.html

分布式事务指事务的操作位于不同的节点上，需要保证事务的 AICD 特性。

例如在下单场景下，库存和订单如果不在同一个节点上，就涉及分布式事务。

### 一、两阶段提交（2PC）

#### 1. 运行过程

##### 1.1 准备阶段

协调者询问参与者事务是否执行成功，参与者发回事务执行结果。

![](https://gitee.com/Wextree/Wex_imgs/raw/master/img/62cf113cd8c40eaafecb9fc6111beef4480.jpg)



##### 1.2 提交阶段

如果事务在每个参与者上都执行成功，事务协调者发送通知让参与者提交事务；否则，协调者发送通知让参与者回滚事务。

需要注意的是，在准备阶段，参与者执行了事务，但是还未提交。只有在提交阶段接收到协调者发来的通知后，才进行提交或者回滚。

![](https://gitee.com/Wextree/Wex_imgs/raw/master/img/6610fc7d97c9277423a9c620487e09db3f8.jpg)



#### 2. 存在的问题

1. 同步阻塞 所有事务参与者在等待其它参与者响应的时候都处于同步阻塞状态，无法进行其它操作。
2. 单点问题 协调者在 2PC 中起到非常大的作用，发生故障将会造成很大影响。特别是在阶段二发生故障，所有参与者会一直等待状态，无法完成其它操作。
3. 数据不一致 在阶段二，如果协调者只发送了部分 Commit 消息，此时网络发生异常，那么只有部分参与者接收到 Commit 消息，也就是说只有部分参与者提交了事务，使得系统数据不一致。
4. 太过保守 任意一个节点失败就会导致整个事务失败，没有完善的容错机制。



### 二、补偿事务（TCC）

 





































