create unique index Scno
on SC(Sno,Cno);

Sp_helpindex SC;

create CLUSTERED index Tnum
on TC(Num);

drop index Tnum on TC;

update SC
set Crade=Grade+2
where Cno in (
	select Cno
	from Course
	where Cname='CS'
);

update Textbook
set Time=getdate()
where Tname='PYTHON';

delete
from Textbook
where Teno not in (
	select Teno
	from TC
);

update TC
set Num=(
	select COUNT(*)
	from SC
	where Cno=TC.Cno
	group by Cno
)+2;

alter table Student add clano char(10);
alter table Student add address char(20);

alter table Textbook
alter Column Press char(20) not null;

alter table Class
alter Column People char(20);

alter table SC
add check (Grade between 0 and 150);

create view stu_avg
as 
select sno,AVG(grade) avg
from SC
group by sno;

create view don_avg
as 
select Sept.Dno,Student.Sno,Student.Sname,stu_avg.avg
from Student,Dept,stu_avg
where Student.Sdept=Dept.Dno and
			stu_avg.sno=Student.sno;
			
create view dno_stu_avg
as
	select Dept.Dno,Student.Sno,Student.Sname,dno_avg.avg avg
	from Student,Dept,stu_avg,dno_avg
	where Student.Sdept=Dept.Dno and
				stu_avg.sno=Studen.sno and
				dno_avg.Dno=Dept.Dno and
				dno_avg.avg=stu_avg.avg;
				
create view S_AVG
as
(
	select Student.Sno,Sname,Ssex,year(getdate())-year(Sbirth) age,Sdept,Course.Cno,Cname,Grade
	from Student,SC,Course
	where Student.Sno=SC.Sno and
				SC.Cno=Course.Cno
);

create view cno_avg
as(
	select Cno,avg(Grade) grade
	from SC
	group by Cno
);

create view TN
as
(
	select Tno,Cno,nice
	from TCourse
);

update TN
set nice='优秀'
where Tno in (
	select Tno
	from TC,cno_avg
	where TC.Cno=cno_avg.Cno and
				cno_avg.grade>90
);